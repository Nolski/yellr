"use strict";var yellr=yellr||{},BASE_URL="/",AUTO_REFRESH=!0;window.onload=function(){if(!Handlebars||!$)return void console.log("missing dependencies for yellr.utils.render_template");null===localStorage.getItem("yellr-mod")?yellr.utils.redirect_to_login():yellr.utils.load_localStorage(),void 0===yellr.DATA&&(yellr.DATA={}),document.querySelector("#logout-btn").onclick=yellr.utils.logout,document.querySelector("#sidebar").setAttribute("style","min-height: "+document.querySelector("body").scrollHeight+"px");var a=document.querySelector("body").getAttribute("data-page");switch(a){case"index":yellr.view.index();break;case"login":yellr.view.login();break;case"create-assignment":yellr.view.create_assignment();break;case"assignments":yellr.view.all_assignments();break;case"single-assignment":yellr.view.view_assignment();break;case"editor":yellr.editor.init();break;case"collections":yellr.view.all_collections();break;case"single-collection":yellr.view.view_collection();break;case"messages":yellr.view.inbox();break;default:console.log("lol ok")}},yellr.assignments=function(){var a,b,c,d,e,f,g,h,i,j,k=[],l=[],m=[],n=function(a){var b=yellr.DATA.assignments.filter(function(b){return b.assignment_id===a?!0:void 0})[0];yellr.utils.render_template({template:"#assignment-overview-template",target:"#view-assignment-section",context:{assignment:b}})},o=function(){yellr.utils.show_overlay({template:"#new-assignment-template"}),a=$("#assignment-form-wrapper"),c=a.find("#questions-container"),f=a.find("#extra-assignment-fields"),h=a.find("#cancel-assignment-btn"),g=a.find("#preview-assignment-btn"),i=a.find("#save-assignment-btn"),j=a.find("#post-assignment-btn"),b=$("#question-text-preview"),a.find(".form-fields-list").hide(),f.hide(),g.hide(),i.hide(),j.hide(),h.on("click",function(){yellr.utils.clear_overlay()}),a.find("#language-select").on("change",function(){"--"!==this.value&&yellr.assignments.create_question_form(this.value)}),i.on("click",function(){yellr.assignments.save_draft()}),g.on("click",function(){console.log("preview assignment"),yellr.assignments.preview_assignment()})},p=function(g){f.hide(),b.removeClass("active"),yellr.utils.render_template({template:"#new-question-template",target:c,context:{language:g}}),d=a.find("#"+g+"-question-form"),d.find(".answers-input-wrapper").hide(),d.find('input[type="radio"]').on("change",function(){"multiple_choice"===this.value?d.find(".answers-input-wrapper").show():d.find(".answers-input-wrapper").hide()}),d.find(".question-answer-input").keypress(function(a){13===a.which&&(a.preventDefault(),l.push(d.find(".question-answer-input").val()),yellr.utils.render_template({template:"#new-survey-answer-template",target:"#survey-answers-list",context:{answer:d.find(".question-answer-input").val()},append:!0}),d.find(".question-answer-input").val(""),console.log(l))}),e=d.find("#question_textarea"),e.on("keyup",function(){b.html(e.val()),""===e.val()&&b.html("Ask the community...")}),b.html("Ask the community..."),j.show(),j.html("Add Question"),j.off("click"),j.on("click",function(){$.ajax({type:"POST",url:yellr.URLS.create_question,data:d.serialize()+"&answers="+JSON.stringify(l),dataType:"json",success:function(a){a.success?(console.log("SUCCESS"),m.push(g),yellr.assignments.successful_question_post(a)):(console.log("FAIL"),console.log(a))}})})},q=function(c){k.push(c.question_id),b.html(e.val()),b.addClass("active"),d.hide(),a.find(".language-select-wrapper").hide(),i.show(),g.show(),j.html("Post Assignment"),j.off("click"),j.on("click",function(){yellr.assignments.post()}),f.show(),this.language_feedback()},r=function(){var a=yellr.DATA.languages.filter(function(a){for(var b=0;b<m.length;b++)if(a.code===m[b])return!0});yellr.utils.render_template({target:"#supported-languages",template:"#language-support-template",context:{languages:a}}),$("#language-select").find('option[value="'+m[m.length-1]+'"]').remove(),$("#add-language-btn").on("click",function(){$("#assignment-form-wrapper .language-select-wrapper").show()})},s=function(){console.log("do some css things to hide this and show that")},t=function(){alert("save draft. NOT IMPLEMENTED. THIS DOES NOTHING LOL")},u=function(){var b=a.find("#lifetime").val(),c=a.find("#unit-of-time-list input:checked").val(),d="days"===c?24:720,e=b*d;$.ajax({type:"POST",yellr:mod.URLS.publish_assignment,data:{life_time:e,questions:JSON.stringify(k),top_left_lat:43.4,top_left_lng:-77.9,bottom_right_lat:43,bottom_right_lng:-77.3},dataType:"json",success:function(a){a.success?$.ajax({url:yellr.URLS.create_collection,type:"POST",dataType:"json",data:{name:"Assignment #"+a.assignment_id+" Collection",description:"Collection for #"+a.assignment_id,tags:"some, example, collection tags"},success:function(a){a.success?(k=[],yellr.utils.clear_overlay()):console.log("something went wrong creating a collection for this assignment")}}).done(function(){yellr.assignments.get_my_assignments({callback:function(){yellr.utils.redirect_to("view-assignment.html#"+a.assignment_id)}})}):alert("Something went wrong submitting an Assignment")}})};return{view:n,setup_form:o,create_question_form:p,successful_question_post:q,post:u,save_draft:t,preview_assignment:s,language_feedback:r}}();var mod=mod||{};mod.collections={setup_form:function(){console.log("hello from: setup_form"),$("#new-collections-form").find(".submit-btn").on("click",function(){console.log("submit the form"),mod.collections.submit_form()})},submit_form:function(){console.log("hello from: submit_form"),console.log("url: "+mod.URLS.create_collection),$.ajax({url:mod.URLS.create_collection,type:"POST",dataType:"json",data:$("#new-collections-form").serialize(),success:function(a){a.success?(console.log("SUCCESS"),console.log(a),mod.utils.clear_overlay()):console.log("something went wrong")}})}};var mod=mod||{};mod.editor=function(){var a=function(){function a(a,b){this.update=function(){var c="# "+$("#article-title").val()+"\n";b.innerHTML=markdown.toHTML(c+a.value)},a.editor=this,this.update()}mod.collections.get_collection(parseInt(window.location.hash.split("#")[1]),function(a){mod.utils.render_template({template:"#collections-li-template",target:"#editor-collections-list",context:{collection:a.collection}})});var b=new a(document.getElementById("markdown-editor"),document.getElementById("editor-preview"));$("#preview-btn").on("click",function(){var a=$("#editor-workspace .editor-container"),c=a.find(".active"),d=a.find(".inactive");c.removeClass("active").addClass("inactive"),d.removeClass("inactive").addClass("active"),b.update()}),$("#editor-controls .submit-btn").on("click",function(){$.post(mod.URLS.publish_story,{title:$("#article-title").val(),tags:"test, 1, 2, 3",top_text:$("#top-text").val(),banner_media_id:"",contents:$("#markdown-editor").val(),language_code:"en",top_left_lat:43.4,top_left_lng:-77.9,bottom_right_lat:43,bottom_right_lng:-77.3},function(a){console.log(a.success?"post successful!":"something went wrong"),console.log(a)})})};return{init:a}}();var mod=mod||{};mod.feed={toggle_collections_dropdown:function(a){$(a.parentNode).hasClass("dropdown-container")?mod.feed.hide_collections_dropdown(a):mod.feed.show_collections_dropdown(a)},show_collections_dropdown:function(a){$(a.parentNode).addClass("dropdown-container"),mod.utils.render_template({template:"#collections-dropdown-template",target:a.parentNode,context:{collections:mod.DATA.collections},append:!0}),$(a.parentNode).find(".collections-dropdown").on("click",function(a){mod.feed.add_post_to_collection_from_feed(a.target)})},hide_collections_dropdown:function(a){$(a.parentNode).removeClass("dropdown-container"),mod.utils.render_template({template:"",target:$(a.parentNode).find(".collections-dropdown")})},add_post_to_collection_from_feed:function(a){var b=$(a.offsetParent.offsetParent.parentNode.parentNode.parentNode),c=b.find(".meta-div").data("post-id"),d=$(a).data("collection-id");mod.collections.add_post_to_collection(c,d,function(b){b&&(a.parentNode.style.opacity="0.3")})}},moderator.filter={settings:{source_type:"all",media_types:["video","photo","audio","text"],text:""},init:function(a){moderator.submissions_grid=a.grid.querySelectorAll(".story-item");var b=document.querySelector(".filter-form");b.querySelector("#filter-submission-type").onclick=this.submission_type,b.querySelector("#filter-content-type").onclick=this.content_type,b.querySelector("#filter-search").onkeyup=this.search},submission_type:function(a){"INPUT"==a.target.tagName&&(moderator.filter.settings.source_type=a.target.value,moderator.filter.grid({array:moderator.submissions_grid,settings:moderator.filter.settings}))},content_type:function(a){if("INPUT"==a.target.tagName){for(var b=[],c=a.target.parentNode.parentNode,d=c.querySelectorAll('input[type="checkbox"]'),e=0;e<d.length;e++){var f=d[e];f.checked&&b.push(f.value)}moderator.filter.settings.media_types=b,moderator.filter.grid({array:moderator.submissions_grid,settings:moderator.filter.settings})}},search:function(a){moderator.filter.settings.text=a.target.value.toLowerCase(),moderator.filter.grid({array:moderator.submissions_grid,settings:moderator.filter.settings})},grid:function(a){for(var b=0;b<a.array.length;b++){var c=a.array[b],d=c.querySelector(".meta-div"),e=c.className;c.className=e.split("filtered-out")[0],"all"!==a.settings.source_type&&d.getAttribute("data-source")!==a.settings.source_type&&(c.className+=" filtered-out");for(var f=d.getAttribute("data-type"),g=!1,h=0;h<a.settings.media_types.length;h++){var i=a.settings.media_types[h];if(f==i){g=!0;break}}g||(c.className+=" filtered-out");var j=new RegExp(moderator.filter.settings.text),k=c.querySelector(".description").innerHTML.toLowerCase();k.search(j)&&(c.className+=" filtered-out")}moderator.packery.reloadItems();for(var l=document.querySelectorAll(".filtered-out"),h=0;h<l.length;h++)moderator.packery.remove(l[h].parentNode);moderator.packery.layout()}};var yellr=yellr||{};yellr.server={create_question:function(a,b){a.answers&&(a.answers=JSON.stringify(a.answers)),$.ajax({type:"POST",url:yellr.URLS.create_question,data:a,dataType:"json",success:function(a){a.success&&b&&b(a)}})},publish_assignment:function(a,b){a.questions=JSON.stringify(a.questions),$.ajax({type:"POST",yellr:yellr.URLS.publish_assignment,data:a,dataType:"json",success:function(a){console.log(a),a.success?b&&b(a):alert("Something went wrong submitting an Assignment")}})},create_collection:function(a,b){$.ajax({url:yellr.URLS.create_collection,type:"POST",dataType:"json",data:a,success:function(a){a.success?b&&b():console.log("something went wrong creating a collection for this assignment")}})},get_posts:function(a){var b=!1,c=[];$.getJSON(yellr.URLS.get_posts,function(a){a.success?(b=!0,c=yellr.utils.convert_object_to_array(a.posts),yellr.DATA.posts=c,yellr.utils.save()):yellr.utils.notify("Something went wrong loading posts.")}).done(function(){b&&a(c)}).fail(function(){yellr.utils.redirect_to_login()})},get_my_assignments:function(a){var b,c=!1;$.getJSON(yellr.URLS.get_my_assignments,function(a){a.success?(c=!0,b=yellr.utils.convert_object_to_array(a.assignments),yellr.DATA.assignments=b,yellr.utils.save()):console.log("something went wrong loading get_my_assignments")}).done(function(){c&&a(b)}).fail(function(){yellr.utils.redirect_to_login()})},get_responses_for:function(a,b){var c,d=!1;$.ajax({url:yellr.URLS.get_assignment_responses+"&assignment_id="+a.toString(),type:"POST",dataType:"json",success:function(a){a.success&&(d=!0,c=a.posts)}}).done(function(){d&&b(c)}).fail(function(){yellr.utils.redirect_to_login()})},get_collection:function(a,b){var c="",d=[],e=!1;$.getJSON(yellr.URLS.get_collection_posts,{collection_id:a},function(a){a.success&&(e=!0,d=yellr.utils.convert_object_to_array(a.posts),c=a.collection_name)}).done(function(){e?b&&b({collection:d,collection_name:c}):console.log("something went wrong loading collection posts")}).fail(function(){yellr.utils.redirect_to_login()})},get_my_collections:function(a){$.getJSON(yellr.URLS.get_my_collections,function(a){a.success?(yellr.DATA.collections=a.collections,yellr.utils.save()):console.log("something went wrong getting your collections")}).done(function(){a&&a()}).fail(function(){yellr.utils.redirect_to_login()})},add_post_to_collection:function(a,b,c){var d=!1;$.post(yellr.URLS.add_post_to_collection,{post_id:a,collection_id:b},function(a){a.success&&(d=!0)}).done(function(){console.log(d?"added post to collection":"something went wrong adding the post to the collection"),c&&c(d)}).fail(function(){return console.log("something went wrong adding the post to the collection"),d})},get_messages:function(a){$.getJSON(yellr.URLS.get_my_messages,function(a){a.success?yellr.DATA.messages=a.messages:yellr.utils.notify("Could not load new messages.")}).done(function(){a&&a()}).fail(function(){yellr.utils.redirect_to_login()})},send_message:function(a,b,c,d,e){var f={subject:a,text:b,to_client_id:c};e&&(f.parent_message_id=e),$.ajax({type:"POST",url:yellr.URLS.create_message,dataType:"json",data:f,success:function(a){yellr.utils.notify(a.success?"Message sent!":"Error sending message. Check the user ID.")}}).done(function(){d&&d()})}};var yellr=yellr||{};yellr.utils={convert_object_to_array:function(a){var b=[];for(var c in a)b.push(a[c]);return b},notify:function(a){console.log(a)},load_latest_posts:function(){AUTO_REFRESH&&setTimeout(function(){console.log("loading latest posts..."),yellr.server.get_posts(function(){yellr.utils.render_template({template:"#raw-feed-item",target:"#raw-feed",context:{posts:yellr.DATA.posts}})}),yellr.utils.load_latest_posts()},1e4)},redirect_to:function(a){var b="/moderator/";window.location.replace(b+a)},redirect_to_login:function(){"login"!==document.querySelector("body").getAttribute("data-page")&&yellr.utils.redirect_to("login.html")},login:function(a,b){var c=BASE_URL+"admin/get_access_token.json?user_name="+a+"&password="+b;$.ajax({type:"POST",url:c,dataType:"json",success:function(a){a.success?(yellr.TOKEN=a.token,yellr.utils.save(),yellr.utils.set_urls(),$.ajax({url:yellr.URLS.get_languages,type:"POST",dataType:"json",success:function(a){a.success?(yellr.DATA.languages=a.languages,yellr.utils.save()):alert("Something went wrong loading Languages. Things might get weird from here...")}}).done(function(){console.log("done loading languages"),yellr.utils.redirect_to("index.html")})):document.querySelector("#login-feedback").innerHTML=a.error_text}})},logout:function(){localStorage.removeItem("yellr-mod"),yellr.utils.redirect_to_login("You have been logged out")},load_localStorage:function(){var a=JSON.parse(localStorage.getItem("yellr-mod"));yellr.DATA=a.DATA,yellr.SETTINGS=a.SETTINGS,yellr.TOKEN=a.TOKEN,yellr.URLS=a.URLS},load:function(a){void 0===yellr.DATA&&(yellr.DATA={}),$.getJSON(yellr.URLS[a.data],function(b){if(b.success){if(a.saveAs){if(Array.isArray(b[a.saveAs])===!1){var c=[];for(var d in b.posts)c.push(b.posts[d]);yellr.DATA[a.saveAs]=c}else yellr.DATA[a.saveAs]=b[a.saveAs];"posts"===a.saveAs&&yellr.DATA.posts.reverse(),yellr.utils.save()}a.callback&&a.callback(b)}else console.log(b),console.log(yellr.URLS[a.data]),console.log("Something went wrong loading: "+a.data+"\nThis could be because your previous session has expired. Please log back in")})},save:function(){localStorage.setItem("yellr-mod",JSON.stringify({DATA:yellr.DATA,SETTINGS:yellr.SETTINGS,TOKEN:yellr.TOKEN,URLS:yellr.URLS}))},set_urls:function(){var a=BASE_URL+"admin/";yellr.URLS={get_posts:a+"get_posts.json?token="+yellr.TOKEN,get_my_messages:a+"get_my_messages.json?token="+yellr.TOKEN,create_message:a+"create_message.json?token="+yellr.TOKEN,create_question:a+"create_question.json?token="+yellr.TOKEN,get_my_assignments:a+"get_my_assignments.json?token="+yellr.TOKEN,publish_assignment:a+"publish_assignment.json?token="+yellr.TOKEN,update_assignment:a+"update_assignment.json?token="+yellr.TOKEN,get_assignment_responses:a+"get_assignment_responses.json?token="+yellr.TOKEN,create_collection:a+"create_collection.json?token="+yellr.TOKEN,get_my_collections:a+"get_my_collections.json?token="+yellr.TOKEN,disable_collection:a+"disable_collection.json?token="+yellr.TOKEN,add_post_to_collection:a+"add_post_to_collection.json?token="+yellr.TOKEN,remove_post_from_collection:a+"remove_post_from_collection.json?token="+yellr.TOKEN,get_collection_posts:a+"get_collection_posts.json?token="+yellr.TOKEN,get_languages:a+"get_languages.json?token="+yellr.TOKEN,get_question_types:a+"get_question_types.json?token="+yellr.TOKEN,create_user:a+"create_user.json?token="+yellr.TOKEN,publish_story:a+"publish_story.json?token="+yellr.TOKEN,upload:BASE_URL+"upload_media.json"},yellr.utils.save()},show_overlay:function(a){var b=document.querySelector("#overlay-div-container");b.className="active",b.onclick=yellr.utils.clear_overlay,a&&this.render_template({template:a.template,context:a.context,target:b})},clear_overlay:function(a){if(void 0===a||"overlay-div-container"===a.target.id){var b=document.querySelector("#overlay-div-container");return b.className="",void b.removeEventListener("click",yellr.utils.clear_overlay,!1)}},render_template:function(a){if(!a.template||""===a.template)return void $(a.target).html("");var b=Handlebars.compile($(a.template).html()),c=b(a.context?a.context:{});a.append?$(a.target).append(c):a.prepend?$(a.target).prepend(c):$(a.target).html(c)}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.all_assignments=function(){yellr.server.get_my_assignments(function(){var a=yellr.DATA.assignments.filter(function(a){return a.title=a.questions[0].question_text,a.expire_datetime=moment(a.expire_datetime).format("MMM Do YYYY"),a.url="view-assignment.html#"+a.assignment_id,!0});yellr.utils.render_template({template:"#my-assignment-li",target:".my-assignments-list",context:{assignments:a}})})};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.all_collections=function(){yellr.server.get_my_collections(function(){var a=yellr.DATA.collections.filter(function(a){return a.collection_datetime=moment(a.collection_datetime).format("MMM Do YYYY"),a.url="view-collection.html#"+a.collection_id,!0});yellr.utils.render_template({template:"#collections-gi-template",target:".collections-grid",context:{collections:a}})}),document.querySelector("#new-collection-btn").onclick=function(){yellr.utils.show_overlay({template:"#collections-form-template"}),yellr.collections.setup_form()},document.querySelector("#delete-collection-btn").onclick=function(){console.log("delete collection")}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.create_assignment=function(){document.querySelector("#post-btn").onclick=function(){for(var a=document.querySelectorAll(".question-container form"),b=document.querySelectorAll("#assignment-question-type input"),c=document.querySelectorAll("#survey-answers-list li"),d=document.querySelector("#lifetime").value,e=document.querySelector("#unit-of-time-list input:checked").value,f=[],g=[],h={},i="days"===e?24:720,j=0;j<a.length;j++){for(var k={language_code:a[j].querySelector("input").value,question_text:a[j].querySelector(".question_text").value,description:a[j].querySelector(".question_description").value},l=0;l<b.length;l++)b[l].checked&&(k.question_type=b[l].value);if("multiple_choice"===k.question_type){for(var m=0;m<c.length;m++)g.push(c[m]);k.answers=g}yellr.server.create_question(k,function(b){f.push(b.question_id),f.length===a.length&&(h.life_time=d*i,h.questions=f,h.top_left_lat=43.4,h.top_left_lng=-77.9,h.bottom_right_lat=43,h.bottom_right_lng=-77.3,console.log("publishing assignment"),yellr.server.publish_assignment(h,function(a){console.log("assignment published"),yellr.server.create_collection({name:"Assignment #"+a.assignment_id+" Collection",description:"Collection for #"+a.assignment_id,tags:"some, example, collection tags"},function(){console.log("collection created"),yellr.server.get_my_assignments(function(){yellr.utils.redirect_to("view-assignment.html#"+a.assignment_id)})})}))})}},document.querySelector("#assignment-question-type").onclick=function(a){if(a.target.checked){var b=document.querySelector(".choices-tab");"multiple_choice"===a.target.value?b.className=b.className.replace("faded",""):b.className+=" faded"}},document.querySelector("#language-select").onchange=function(){if("--"!==this.value){yellr.utils.render_template({template:"#question-form-template",target:".question-container",context:{language:this.value,language_code:this.value.toLowerCase().substring(0,2)},append:!0});for(var a=0;a<this.options.length;a++)this.options[a].value===this.value&&(this.removeChild(this.options[a]),1===this.options.length&&document.querySelector("#questions-container").removeChild(document.querySelector(".language-select-wrapper")))}}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.inbox=function(){$.getJSON(args.data_url,function(a){raw_data=a.messages,self.render()});var a=template({messages:raw_data});$(unread_target).html(a),$(read_target).html(a),yellr.server.get_messages(function(){}),document.querySelector("#inbox").onclick=function(a){var b="LI"===a.target.nodeName?a.target.getAttribute("data-id"):a.target.parentNode.getAttribute("data-id"),c=yellr.DATA.messages.filter(function(a){return a.message_id===parseInt(b)?!0:void 0})[0];yellr.utils.show_overlay({template:"#view-message-template",context:c})}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.index=function(){var a,b=document.querySelector("#raw-feed");yellr.server.get_my_assignments(function(a){for(var b=[],c=0;c<a.length&&(b.push(a[c]),!(b.length>=4));c++);b.filter(function(a){a.expire_datetime=moment(a.expire_datetime).fromNow(!0)}),yellr.utils.render_template({template:"#active-assignment-template",target:"#active-assignments-list",context:{assignments:b}})}),yellr.server.get_posts(function(){yellr.utils.render_template({template:"#raw-feed-item",target:"#raw-feed",context:{posts:yellr.DATA.posts},append:!0}),setTimeout(function(){a=new Packery(b,{itemSelector:".feed-gi",columnWidth:".feed-sizer",gutter:".feed-gutter"})},1e3)}),document.querySelector("#feed-view").onclick=function(c){var d,e;if(c.target.checked)if(d=c.target.value,"list"===d){e=b.querySelectorAll(".feed-gi");for(var f=0;f<e.length;f++)e[f].className="gi";a.destroy()}else{e=b.querySelectorAll(".gi");for(var f=0;f<e.length;f++)e[f].className="feed-gi";a=new Packery(b,{itemSelector:".feed-gi",columnWidth:".feed-sizer",gutter:".feed-gutter"})}},document.querySelector("#auto-update").onclick=function(a){a.target.checked===!0?(AUTO_REFRESH=!0,yellr.utils.load_latest_posts()):AUTO_REFRESH=!1},document.querySelector(".feed-filter-div").onclick=function(){console.log("hello from: ")},b.onclick=function(a){switch(console.log("lol"),a.target.className){case"fa fa-folder":yellr.feed.toggle_collections_dropdown(a.target);break;case"fa fa-comment":var b=a.target.offsetParent.querySelector(".meta-div"),c=parseInt(b.getAttribute("data-post-id")),d=yellr.DATA.posts.filter(function(a){return a.post_id===c?!0:void 0})[0];yellr.utils.show_overlay({template:"#send-message-template",context:{uid:d.client_id,subject:"RE: "+d.title}});var e=$("#send-message-form");e.submit(function(a){a.preventDefault();var b=e.serializeArray();yellr.messages.send_message({to:b[0],subject:b[1],text:b[2],callback:function(){yellr.utils.clear_overlay()}})});break;case"fa fa-flag":console.log("report the motherfucker")}},yellr.utils.load_latest_posts()};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.login=function(){var a=$("#mod-login");a.submit(function(b){b.preventDefault();var c=a.serializeArray();yellr.utils.login(c[0].value,c[1].value)})};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.view_assignment=function(){var a=parseInt(window.location.hash.split("#")[1]);if(0/0!==a){var b=yellr.DATA.assignments.filter(function(b){return b.assignment_id===a?!0:void 0})[0];yellr.utils.render_template({template:"#assignment-overview-template",target:"#view-assignment-section",context:{assignment:b}}),yellr.server.get_responses_for(a,function(a){var b=yellr.utils.convert_object_to_array(a);yellr.utils.render_template({template:"#assignment-response-li-template",target:"#assignment-replies-list",context:{replies:b}});var c=document.querySelector(".assignment-deadline");c.innerHTML=moment(c.innerHTML).format("MMMM Do YYYY");var d=document.querySelector(".assignment-published");d.innerHTML=moment(d.innerHTML).format("MMMM Do YYYY")}),yellr.server.get_collection(a,function(a){yellr.utils.render_template({template:"#collections-li-template",target:"#assignment-collection-list",context:{collection:a.collection}})}),document.querySelector("#assignment-collection-list").setAttribute("data-collection-id",a)}};var yellr=yellr||{};yellr.view=yellr.view||{},yellr.view.view_collection=function(){var a,b,c,d,e=[],f=0;f=parseInt(window.location.hash.split("#")[1]),yellr.server.get_collection(f,function(a){document.querySelector(".t1").innerHTML=a.collection_name,yellr.utils.render_template({template:"#view-collection-gi-template",target:"#collection-wrapper",context:{collection:a.collection},append:!0}),e=document.querySelectorAll(".collection-gi"),setTimeout(function(){d=new Packery(c,{itemSelector:".collection-gi",columnWidth:".collection-grid-sizer",gutter:".gutter-sizer"})},500)}),c=document.querySelector("#collection-wrapper"),c.onclick=function(a){"fa fa-comment"===a.target.className?alert("Send message"):"fa fa-close"===a.target.className&&alert("Remove item from collection")},b=document.querySelector("#export-content-btn"),b.onclick=function(){alert("TODO: Download zip file of media collection")},a=document.querySelector(".collection-view-controls"),a.onclick=function(a){if(a.target.checked)if("list"===a.target.defaultValue){d.destroy();for(var b=0;b<e.length;b++)e[b].className="gi"}else{for(var b=0;b<e.length;b++)e[b].className="collection-gi";d=new Packery(c,{itemSelector:".collection-gi",columnWidth:".collection-grid-sizer",gutter:".gutter-sizer"})}}};