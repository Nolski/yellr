/*!
 * yellr v0.0.1 (http://hhroc.github.io/)
 * Copyright 2014 hhroc - Hacks and Hackers Rochester
 * Licensed under MIT (https://github.com/hhroc/yellr/blob/master/LICENSE)
 */


"use strict";var yellr=yellr||{};yellr.main={init:function(){switch(null===localStorage.getItem("yellr-frontpage")?(yellr.utils.create_user(),yellr.utils.save()):yellr.utils.load_localStorage(),yellr.PAGE=document.querySelector("#storefront").getAttribute("data-page"),yellr.PAGE){case"index":$.getJSON(yellr.URLS.stories,function(a){console.log(a.success?a:"something went wrong loading stories")});break;case"article":document.querySelector(".published-datetime").innerHTML=moment(document.querySelector(".published-datetime").innerHTML,"YYYY-MM-DD HH:mm:ss").format("MMM Do YYYY");break;case"about":var a=$("#newsletter-form");a.submit(function(b){b.preventDefault,yellr.utils.email_signup(a.serealize())});break;case"submit-tip":document.querySelector(".submit-news-tip-btn").setAttribute("style","display:none;"),document.querySelector("#add-extra-media div.flex").onclick=function(a){if("I"===a.target.nodeName||"DIV"===a.target.nodeName){var b="I"===a.target.nodeName?a.target.parentNode.className:a.target.className,c="#"+b.split("add-")[1].split(" ")[0]+"-form-template";yellr.utils.render_template({template:c,target:".forms-wrapper",append:!0})}},document.querySelector(".submit-btn").onclick=function(a){a.preventDefault(),yellr.utils.submit_form()};break;default:console.log("lol ok")}}},window.onload=yellr.main.init;var yellr=yellr||{};yellr.utils={create_user:function(){yellr.UUID=yellr.utils.guid(),yellr.SETTINGS={lat:43.2,lng:-77.6,language:{code:"en",name:"English",set:function(a){this.code=a,"en"===a&&(this.name="English"),"es"===a&&(this.name="Espa√±ol"),"fr"===a&&(this.name="French")}}},yellr.utils.set_urls()},set_urls:function(){var a="http://127.0.0.1:8080/",b={stories:a+"get_stories.json?client_id="+yellr.UUID+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng+"&language_code="+yellr.SETTINGS.language.code,upload:a+"upload_media.json",post:a+"publish_post.json"};yellr.URLS=b},load_localStorage:function(){var a=JSON.parse(localStorage.getItem("yellr-frontpage"));yellr.SETTINGS=a.SETTINGS,yellr.UUID=a.UUID,yellr.URLS=a.URLS},save:function(){localStorage.setItem("yellr-frontpage",JSON.stringify({SETTINGS:yellr.SETTINGS,URLS:yellr.URLS,UUID:yellr.UUID}))},submit_form:function(){for(var a=document.querySelectorAll(".forms-wrapper form"),b=0,c=[],d=0;d<a.length;d++){var e=a[d];$(e).ajaxSubmit({url:yellr.URLS.upload,data:{client_id:yellr.UUID},success:function(d){d.success?(b++,c.push(d.media_id),b===a.length&&yellr.utils.publish_post(c)):(console.log("Something went wrong with upload_media..."),console.log(d))},clearForm:!0})}},publish_post:function(a){$.post(yellr.URLS.post,{title:"Web Submission",client_id:yellr.UUID,assignment_id:null,language_code:yellr.SETTINGS.language.code,lat:yellr.SETTINGS.lat,lng:yellr.SETTINGS.lng,media_objects:JSON.stringify(a)},function(){console.log("post published"),yellr.UUID=yellr.utils.guid(),yellr.utils.save()})},email_signup:function(a){$.ajax({url:"tbd",type:"POST",dataType:"json",data:a,success:function(){alert("Thanks for signing up!")}})},guid:function(a,b){/*!
      Math.uuid.js (v1.4)
      http://www.broofa.com
      mailto:robert@broofa.com
      http://www.broofa.com/2008/09/javascript-uuid-function/

      Copyright (c) 2010 Robert Kieffer
      Dual licensed under the MIT and GPL licenses.
    */
var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=d,f=[];if(b=b||e.length,a)for(c=0;a>c;c++)f[c]=e[0|Math.random()*b];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",c=0;36>c;c++)f[c]||(g=0|16*Math.random(),f[c]=e[19==c?3&g|8:g])}return f.join("")},render_template:function(a){if(!Handlebars||!$)return void console.log("missing dependencies for yellr.utils.render_template");if(!a.template||""===a.template)return void $(a.target).html("");var b=Handlebars.compile($(a.template).html()),c=b(a.context?a.context:{});a.append?$(a.target).append(c):a.prepend?$(a.target).prepend(c):$(a.target).html(c)}};